import{c as ce,a as Y,f as de,u as fe,b as me,d as pe,e as ae,g as he,h as Ve,i as ve,j as G,V as ge,k as xe,l as ye,N as le,m as Ce,n as ke,o as be,p as we,q as Be,r as _e,s as A,t as Te,v as Se,w as ee,x as te,y as re,z as d,_ as C,A as Ne,B as X,C as se,D as Ee,E as D,F as Re,G as Oe,H as Ae,I as Ie,J as ne,K as oe}from"./index-2eba7192.js";import"vue";function Ue(e){return e.map(ue)}function ue(e){var a,n;return typeof e=="string"?{label:e,value:e}:e.type==="group"?{type:"group",label:(a=e.label)!==null&&a!==void 0?a:e.name,value:(n=e.value)!==null&&n!==void 0?n:e.name,key:e.key||e.name,children:e.children.map(r=>ue(r))}:e}const De=ce([Y("auto-complete",`
 z-index: auto;
 position: relative;
 display: inline-flex;
 width: 100%;
 `),Y("auto-complete-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[de({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),Fe=Object.assign(Object.assign({},ae.props),{to:G.propTo,menuProps:Object,bordered:{type:Boolean,default:void 0},clearable:{type:Boolean,default:void 0},defaultValue:{type:String,default:null},loading:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},placeholder:String,placement:{type:String,default:"bottom-start"},value:String,blurAfterSelect:Boolean,clearAfterSelect:Boolean,getShow:Function,inputProps:Object,renderOption:Function,renderLabel:Function,size:String,options:{type:Array,default:()=>[]},zIndex:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onSelect:[Function,Array],onBlur:[Function,Array],onFocus:[Function,Array],onInput:[Function,Array]}),Le=Vue.defineComponent({name:"AutoComplete",props:Fe,setup(e){const{mergedBorderedRef:a,namespaceRef:n,mergedClsPrefixRef:i,inlineThemeDisabled:r}=fe(e),s=me(e),{mergedSizeRef:v,mergedDisabledRef:m,mergedStatusRef:k}=s,p=Vue.ref(null),h=Vue.ref(null),E=Vue.ref(e.defaultValue),S=Vue.toRef(e,"value"),T=pe(S,E),_=Vue.ref(!1),R=Vue.ref(!1),g=ae("AutoComplete","-auto-complete",De,we,e,i),b=Vue.computed(()=>Ue(e.options)),F=Vue.computed(()=>{const{getShow:t}=e;return t?t(T.value||""):!!T.value}),w=Vue.computed(()=>F.value&&_.value&&!!b.value.length),x=Vue.computed(()=>he(b.value,Be("value","children")));function O(t){const{"onUpdate:value":l,onUpdateValue:f,onInput:B}=e,{nTriggerFormInput:y,nTriggerFormChange:N}=s;f&&A(f,t),l&&A(l,t),B&&A(B,t),E.value=t,y(),N()}function L(t){const{onSelect:l}=e,{nTriggerFormInput:f,nTriggerFormChange:B}=s;l&&A(l,t),f(),B()}function I(t){const{onBlur:l}=e,{nTriggerFormBlur:f}=s;l&&A(l,t),f()}function z(t){const{onFocus:l}=e,{nTriggerFormFocus:f}=s;l&&A(l,t),f()}function P(){R.value=!0}function M(){window.setTimeout(()=>{R.value=!1},0)}function j(t){var l,f,B;switch(t.key){case"Enter":if(!R.value){const y=(l=h.value)===null||l===void 0?void 0:l.getPendingTmNode();y&&($(y.rawNode),t.preventDefault())}break;case"ArrowDown":(f=h.value)===null||f===void 0||f.next();break;case"ArrowUp":(B=h.value)===null||B===void 0||B.prev();break}}function $(t){(t==null?void 0:t.value)!==void 0&&(L(t.value),e.clearAfterSelect?O(null):t.label!==void 0&&O(t.label),_.value=!1,e.blurAfterSelect&&Q())}function q(){O(null)}function H(t){_.value=!0,z(t)}function K(t){_.value=!1,I(t)}function Z(t){_.value=!0,O(t)}function J(t){$(t.rawNode)}function W(t){var l;!((l=p.value)===null||l===void 0)&&l.contains(_e(t))||(_.value=!1)}function Q(){var t,l;!((t=p.value)===null||t===void 0)&&t.contains(document.activeElement)&&((l=document.activeElement)===null||l===void 0||l.blur())}const o=Vue.computed(()=>{const{common:{cubicBezierEaseInOut:t},self:{menuBoxShadow:l}}=g.value;return{"--n-menu-box-shadow":l,"--n-bezier":t}}),u=r?Ve("auto-complete",void 0,o,e):void 0,c=Vue.ref(null),V={focus:()=>{var t;(t=c.value)===null||t===void 0||t.focus()},blur:()=>{var t;(t=c.value)===null||t===void 0||t.blur()}};return{focus:V.focus,blur:V.blur,inputInstRef:c,uncontrolledValue:E,mergedValue:T,isMounted:ve(),adjustedTo:G(e),menuInstRef:h,triggerElRef:p,treeMate:x,mergedSize:v,mergedDisabled:m,active:w,mergedStatus:k,handleClear:q,handleFocus:H,handleBlur:K,handleInput:Z,handleToggle:J,handleClickOutsideMenu:W,handleCompositionStart:P,handleCompositionEnd:M,handleKeyDown:j,mergedTheme:g,cssVars:r?void 0:o,themeClass:u==null?void 0:u.themeClass,onRender:u==null?void 0:u.onRender,mergedBordered:a,namespace:n,mergedClsPrefix:i}},render(){const{mergedClsPrefix:e}=this;return Vue.h("div",{class:`${e}-auto-complete`,ref:"triggerElRef",onKeydown:this.handleKeyDown,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd},Vue.h(ge,null,{default:()=>[Vue.h(xe,null,{default:()=>{if(this.$slots.default)return ye(this.$slots,"default",{handleInput:this.handleInput,handleFocus:this.handleFocus,handleBlur:this.handleBlur,value:this.mergedValue});const{mergedTheme:n}=this;return Vue.h(le,{ref:"inputInstRef",status:this.mergedStatus,theme:n.peers.Input,themeOverrides:n.peerOverrides.Input,bordered:this.mergedBordered,value:this.mergedValue,placeholder:this.placeholder,size:this.mergedSize,disabled:this.mergedDisabled,clearable:this.clearable,loading:this.loading,inputProps:this.inputProps,onClear:this.handleClear,onFocus:this.handleFocus,onUpdateValue:this.handleInput,onBlur:this.handleBlur},{suffix:()=>{var i,r;return(r=(i=this.$slots).suffix)===null||r===void 0?void 0:r.call(i)},prefix:()=>{var i,r;return(r=(i=this.$slots).prefix)===null||r===void 0?void 0:r.call(i)}})}}),Vue.h(Ce,{show:this.active,to:this.adjustedTo,containerClass:this.namespace,zIndex:this.zIndex,teleportDisabled:this.adjustedTo===G.tdkey,placement:this.placement,width:"target"},{default:()=>Vue.h(Vue.Transition,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{var a;if((a=this.onRender)===null||a===void 0||a.call(this),!this.active)return null;const{menuProps:n}=this;return Vue.withDirectives(Vue.h(ke,Object.assign({},n,{clsPrefix:e,ref:"menuInstRef",theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,"auto-pending":!0,class:[`${e}-auto-complete-menu`,this.themeClass,n==null?void 0:n.class],style:[n==null?void 0:n.style,this.cssVars],treeMate:this.treeMate,multiple:!1,renderLabel:this.renderLabel,renderOption:this.renderOption,size:"medium",onToggle:this.handleToggle})),[[be,this.handleClickOutsideMenu,void 0,{capture:!0}]])}})})]}))}}),Me={key:1,class:"text-[28px] dark:text-white"},$e=Vue.createElementVNode("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",width:"1em",height:"1em"},[Vue.createElementVNode("path",{d:"M29.71,13.09A8.09,8.09,0,0,0,20.34,2.68a8.08,8.08,0,0,0-13.7,2.9A8.08,8.08,0,0,0,2.3,18.9,8,8,0,0,0,3,25.45a8.08,8.08,0,0,0,8.69,3.87,8,8,0,0,0,6,2.68,8.09,8.09,0,0,0,7.7-5.61,8,8,0,0,0,5.33-3.86A8.09,8.09,0,0,0,29.71,13.09Zm-12,16.82a6,6,0,0,1-3.84-1.39l.19-.11,6.37-3.68a1,1,0,0,0,.53-.91v-9l2.69,1.56a.08.08,0,0,1,.05.07v7.44A6,6,0,0,1,17.68,29.91ZM4.8,24.41a6,6,0,0,1-.71-4l.19.11,6.37,3.68a1,1,0,0,0,1,0l7.79-4.49V22.8a.09.09,0,0,1,0,.08L13,26.6A6,6,0,0,1,4.8,24.41ZM3.12,10.53A6,6,0,0,1,6.28,7.9v7.57a1,1,0,0,0,.51.9l7.75,4.47L11.85,22.4a.14.14,0,0,1-.09,0L5.32,18.68a6,6,0,0,1-2.2-8.18Zm22.13,5.14-7.78-4.52L20.16,9.6a.08.08,0,0,1,.09,0l6.44,3.72a6,6,0,0,1-.9,10.81V16.56A1.06,1.06,0,0,0,25.25,15.67Zm2.68-4-.19-.12-6.36-3.7a1,1,0,0,0-1.05,0l-7.78,4.49V9.2a.09.09,0,0,1,0-.09L19,5.4a6,6,0,0,1,8.91,6.21ZM11.08,17.15,8.38,15.6a.14.14,0,0,1-.05-.08V8.1a6,6,0,0,1,9.84-4.61L18,3.6,11.61,7.28a1,1,0,0,0-.53.91ZM12.54,14,16,12l3.47,2v4L16,20l-3.47-2Z",fill:"currentColor"})],-1),ze=[$e],Pe=Vue.defineComponent({__name:"Avatar",props:{image:{type:Boolean}},setup(e){const a=Te(),n=Vue.computed(()=>a.userInfo.avatar);return(i,r)=>e.image?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:0},[Vue.unref(Se)(Vue.unref(n))&&Vue.unref(n).length>0?(Vue.openBlock(),Vue.createBlock(Vue.unref(ee),{key:0,src:Vue.unref(n),"fallback-src":Vue.unref(te)},null,8,["src","fallback-src"])):(Vue.openBlock(),Vue.createBlock(Vue.unref(ee),{key:1,round:"",src:Vue.unref(te)},null,8,["src"]))],64)):(Vue.openBlock(),Vue.createElementBlock("span",Me,ze))}}),je={key:0,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},qe=["innerHTML"],He=["textContent"],Ke=Vue.defineComponent({__name:"Text",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean}},setup(e,{expose:a}){const n=e,{isMobile:i}=re(),r=Vue.ref(),s=new MarkdownIt({linkify:!0,highlight(p,h){if(!!(h&&hljs.getLanguage(h))){const S=h??"";return k(hljs.highlight(S,p,!0).value,S)}return k(hljs.highlightAuto(p).value,"")}});s.use(mdKatex,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const v=Vue.computed(()=>["text-wrap","min-w-[20px]","rounded-md",i.value?"p-2":"px-3 py-2",n.inversion?"bg-[#d2f9d1]":"bg-[#f4f6f8]",n.inversion?"dark:bg-[#a1dc95]":"dark:bg-[#1e1e20]",{"text-red-500":n.error}]),m=Vue.computed(()=>{const p=n.text??"";return n.inversion?p:s.render(p)});function k(p,h){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${h}</span><span class="code-block-header__copy">${d("chat.copyCode")}</span></div><code class="hljs code-block-body ${h}">${p}</code></pre>`}return a({textRef:r}),(p,h)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:Vue.normalizeClass(["text-black",Vue.unref(v)])},[e.loading?(Vue.openBlock(),Vue.createElementBlock("span",je)):(Vue.openBlock(),Vue.createElementBlock("div",{key:1,ref_key:"textRef",ref:r,class:"leading-relaxed break-words"},[e.inversion?(Vue.openBlock(),Vue.createElementBlock("div",{key:1,class:"whitespace-pre-wrap",textContent:Vue.toDisplayString(Vue.unref(m))},null,8,He)):(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:"markdown-body",innerHTML:Vue.unref(m)},null,8,qe))],512))],2))}});function ie(e){const a={origin:!0,...e};let n;a.origin?n=document.createElement("textarea"):n=document.createElement("input"),n.setAttribute("readonly","readonly"),n.value=a.text,document.body.appendChild(n),n.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(n)}const Ze=()=>({iconRender:a=>{const{color:n,fontSize:i,icon:r}=a,s={};return n&&(s.color=n),i&&(s.fontSize=`${i}px`),r||window.console.warn("iconRender: icon is required"),()=>Vue.h(C,{icon:r,style:s})}}),Je={class:"flex flex-col"},We={class:"transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-200"},Qe=Vue.defineComponent({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean}},emits:["regenerate","delete"],setup(e,{emit:a}){const n=e,{iconRender:i}=Ze(),r=Vue.ref(),s=[{label:d("chat.copy"),key:"copyText",icon:i({icon:"ri:file-copy-2-line"})},{label:d("common.delete"),key:"delete",icon:i({icon:"ri:delete-bin-line"})}];function v(k){switch(k){case"copyText":ie({text:n.text??""});return;case"delete":a("delete")}}function m(){a("regenerate")}return(k,p)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:Vue.normalizeClass(["flex w-full mb-6 overflow-hidden",[{"flex-row-reverse":e.inversion}]])},[Vue.createElementVNode("div",{class:Vue.normalizeClass(["flex items-center justify-center flex-shrink-0 h-8 overflow-hidden rounded-full basis-8",[e.inversion?"ml-2":"mr-2"]])},[Vue.createVNode(Pe,{image:e.inversion},null,8,["image"])],2),Vue.createElementVNode("div",{class:Vue.normalizeClass(["overflow-hidden text-sm",[e.inversion?"items-end":"items-start"]])},[Vue.createElementVNode("p",{class:Vue.normalizeClass(["text-xs text-[#b4bbc4]",[e.inversion?"text-right":"text-left"]])},Vue.toDisplayString(e.dateTime),3),Vue.createElementVNode("div",{class:Vue.normalizeClass(["flex items-end gap-1 mt-2",[e.inversion?"flex-row-reverse":"flex-row"]])},[Vue.createVNode(Ke,{ref_key:"textRef",ref:r,inversion:e.inversion,error:e.error,text:e.text,loading:e.loading},null,8,["inversion","error","text","loading"]),Vue.createElementVNode("div",Je,[e.inversion?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createElementBlock("button",{key:0,class:"mb-2 transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-300",onClick:m},[Vue.createVNode(Vue.unref(C),{icon:"ri:restart-line"})])),Vue.createVNode(Vue.unref(Ne),{placement:e.inversion?"left":"right",options:s,onSelect:v},{default:Vue.withCtx(()=>[Vue.createElementVNode("button",We,[Vue.createVNode(Vue.unref(C),{icon:"ri:more-2-fill"})])]),_:1},8,["placement"])])],2)],2)],2))}});function Ge(){const e=Vue.ref(null);return{scrollRef:e,scrollToBottom:async()=>{await Vue.nextTick(),e.value&&(e.value.scrollTop=e.value.scrollHeight)},scrollToTop:async()=>{await Vue.nextTick(),e.value&&(e.value.scrollTop=0)},scrollToBottomIfAtBottom:async()=>{await Vue.nextTick(),e.value&&e.value.scrollHeight-e.value.scrollTop-e.value.clientHeight<=50&&(e.value.scrollTop=e.value.scrollHeight)}}}function Xe(){const e=X();return{addChat:(s,v)=>{e.addChatByUuid(s,v)},updateChat:(s,v,m)=>{e.updateChatByUuid(s,v,m)},updateChatSome:(s,v,m)=>{e.updateChatSomeByUuid(s,v,m)},getChatByUuidAndIndex:(s,v)=>e.getChatByUuidAndIndex(s,v)}}function Ye(){function e(){document.querySelectorAll(".code-block-wrapper").forEach(n=>{const i=n.querySelector(".code-block-header__copy"),r=n.querySelector(".code-block-body");i&&r&&i.addEventListener("click",()=>{var s;(s=navigator.clipboard)!=null&&s.writeText?navigator.clipboard.writeText(r.textContent??""):ie({text:r.textContent??"",origin:!0})})})}Vue.onMounted(()=>e()),Vue.onUpdated(()=>e())}function et(){const e=se(),a=Vue.ref(!0);function n(){a.value=!a.value,a.value?e.success(d("chat.turnOnContext")):e.warning(d("chat.turnOffContext"))}return{usingContext:a,toggleUsingContext:n}}const tt={class:"sticky top-0 left-0 right-0 z-30 border-b dark:border-neutral-800 bg-white/80 dark:bg-black/20 backdrop-blur"},nt={class:"relative flex items-center justify-between min-w-0 overflow-hidden h-14"},ot={class:"flex items-center"},at={class:"flex items-center space-x-2"},lt={class:"text-xl text-[#4f555e] dark:text-white"},rt=Vue.defineComponent({__name:"index",props:{usingContext:{type:Boolean}},emits:["export","toggleUsingContext"],setup(e,{emit:a}){const n=Ee(),i=X(),r=Vue.computed(()=>n.siderCollapsed),s=Vue.computed(()=>i.getChatHistoryByCurrentActive);function v(){n.setSiderCollapsed(!r.value)}function m(){const h=document.querySelector("#scrollRef");h&&Vue.nextTick(()=>h.scrollTop=0)}function k(){a("export")}function p(){a("toggleUsingContext")}return(h,E)=>{var S;return Vue.openBlock(),Vue.createElementBlock("header",tt,[Vue.createElementVNode("div",nt,[Vue.createElementVNode("div",ot,[Vue.createElementVNode("button",{class:"flex items-center justify-center w-11 h-11",onClick:v},[Vue.unref(r)?(Vue.openBlock(),Vue.createBlock(Vue.unref(C),{key:0,class:"text-2xl",icon:"ri:align-justify"})):(Vue.openBlock(),Vue.createBlock(Vue.unref(C),{key:1,class:"text-2xl",icon:"ri:align-right"}))])]),Vue.createElementVNode("h1",{class:"flex-1 px-4 pr-6 overflow-hidden cursor-pointer select-none text-ellipsis whitespace-nowrap",onDblclick:m},Vue.toDisplayString(((S=Vue.unref(s))==null?void 0:S.title)??""),33),Vue.createElementVNode("div",at,[Vue.createVNode(Vue.unref(D),{onClick:p},{default:Vue.withCtx(()=>[Vue.createElementVNode("span",{class:Vue.normalizeClass(["text-xl",{"text-[#4b9e5f]":e.usingContext,"text-[#a8071a]":!e.usingContext}])},[Vue.createVNode(Vue.unref(C),{icon:"ri:chat-history-line"})],2)]),_:1}),Vue.createVNode(Vue.unref(D),{onClick:k},{default:Vue.withCtx(()=>[Vue.createElementVNode("span",lt,[Vue.createVNode(Vue.unref(C),{icon:"ri:download-2-line"})])]),_:1})])])])}}}),st={class:"flex flex-col w-full h-full"},ut={class:"flex-1 overflow-hidden"},it={key:0,class:"flex items-center justify-center mt-4 text-center text-neutral-300"},ct=Vue.createElementVNode("span",null,"欢迎使用chatgpt~",-1),dt={key:1},ft={class:"sticky bottom-0 left-0 flex justify-center"},mt={class:"w-full max-w-screen-xl m-auto"},pt={class:"flex items-center justify-between space-x-2"},ht={class:"text-xl text-[#4f555e] dark:text-white"},Vt={class:"text-xl text-[#4f555e] dark:text-white"},vt={class:"dark:text-black"},yt=Vue.defineComponent({__name:"index",setup(e){let a=new AbortController;const n=!1,i=Re(),r=Oe(),s=se(),v=X();Ye();const{isMobile:m}=re(),{addChat:k,updateChat:p,updateChatSome:h,getChatByUuidAndIndex:E}=Xe(),{scrollRef:S,scrollToBottom:T}=Ge(),{usingContext:_,toggleUsingContext:R}=et(),{uuid:g}=i.params,b=Vue.computed(()=>v.getChatByUuid(+g)),F=Vue.computed(()=>b.value.filter(o=>!o.inversion&&!o.error)),w=Vue.ref(""),x=Vue.ref(!1),O=Ae(),{promptList:L}=Ie(O);function I(){z()}async function z(){var V;let o=w.value;if(x.value||!o||o.trim()==="")return;a=new AbortController,k(+g,{dateTime:new Date().toLocaleString(),text:o,inversion:!0,error:!1,conversationOptions:null,requestOptions:{prompt:o,options:null}}),T(),x.value=!0,w.value="";let u={};const c=(V=F.value[F.value.length-1])==null?void 0:V.conversationOptions;console.log(c),c&&_.value&&(u={...c}),k(+g,{dateTime:new Date().toLocaleString(),text:"",loading:!0,inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:o,options:{...u}}}),T();try{await(async()=>{await oe({prompt:o,options:u,signal:a.signal,onDownloadProgress:async({event:l})=>{const f=l.target,{responseText:B}=f,y=B.split("&KFw6loC9Qvy&");try{const N=JSON.parse(y[0]),U=y[2]&&JSON.parse(y[2]);p(+g,b.value.length-1,{dateTime:new Date().toLocaleString(),text:y[1]||"",inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:N.conversationId,parentMessageId:N.id},requestOptions:{prompt:o,options:{...u}}}),n&&U&&U.detail.choices[0].finish_reason,T()}catch{}}})})()}catch(t){const l=(t==null?void 0:t.message)??d("common.wrong");if(t.message==="canceled"){h(+g,b.value.length-1,{loading:!1}),T();return}const f=E(+g,b.value.length-1);if(f!=null&&f.text&&f.text!==""){h(+g,b.value.length-1,{text:`${f.text}
[${l}]`,error:!1,loading:!1});return}p(+g,b.value.length-1,{dateTime:new Date().toLocaleString(),text:l,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:o,options:{...u}}}),T()}finally{x.value=!1}}async function P(o){if(x.value)return;a=new AbortController;const{requestOptions:u}=b.value[o];let c=(u==null?void 0:u.prompt)??"",V={};u.options&&(V={...u.options}),x.value=!0,p(+g,o,{dateTime:new Date().toLocaleString(),text:"",inversion:!1,error:!1,loading:!0,conversationOptions:null,requestOptions:{prompt:c,...V}});try{await(async()=>{await oe({prompt:c,options:V,signal:a.signal,onDownloadProgress:({event:l})=>{const f=l.target,{responseText:B}=f,y=B.split("&KFw6loC9Qvy&");try{const N=JSON.parse(y[0]),U=y[2]&&JSON.parse(y[2]);p(+g,o,{dateTime:new Date().toLocaleString(),text:y[1]||"",inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:N.conversationId,parentMessageId:N.id},requestOptions:{prompt:c,...V}}),n&&U&&U.detail.choices[0].finish_reason}catch{}}})})()}catch(t){if(t.message==="canceled"){h(+g,o,{loading:!1});return}const l=(t==null?void 0:t.message)??d("common.wrong");p(+g,o,{dateTime:new Date().toLocaleString(),text:l,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:c,...V}})}finally{x.value=!1}}function M(){if(x.value)return;const o=r.warning({title:d("chat.exportImage"),content:d("chat.exportImageConfirm"),positiveText:d("common.yes"),negativeText:d("common.no"),onPositiveClick:async()=>{try{o.loading=!0;const u=document.getElementById("image-wrapper"),V=(await html2canvas(u,{useCORS:!0})).toDataURL("image/png"),t=document.createElement("a");t.style.display="none",t.href=V,t.setAttribute("download","chat-shot.png"),typeof t.download>"u"&&t.setAttribute("target","_blank"),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(V),o.loading=!1,s.success(d("chat.exportSuccess")),Promise.resolve()}catch{s.error(d("chat.exportFailed"))}finally{o.loading=!1}}})}function j(o){x.value||r.warning({title:d("chat.deleteMessage"),content:d("chat.deleteMessageConfirm"),positiveText:d("common.yes"),negativeText:d("common.no"),onPositiveClick:()=>{v.deleteChatByUuid(+g,o)}})}function $(){x.value||r.warning({title:d("chat.clearChat"),content:d("chat.clearChatConfirm"),positiveText:d("common.yes"),negativeText:d("common.no"),onPositiveClick:()=>{v.clearChatByUuid(+g)}})}function q(o){m.value?o.key==="Enter"&&o.ctrlKey&&(o.preventDefault(),I()):o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),I())}function H(){x.value&&(a.abort(),x.value=!1)}const K=Vue.computed(()=>w.value.startsWith("/")?L.value.filter(o=>o.key.toLowerCase().includes(w.value.substring(1).toLowerCase())).map(o=>({label:o.value,value:o.value})):[]),Z=o=>{for(const u of L.value)if(u.value===o.label)return[u.key];return[]},J=Vue.computed(()=>m.value?d("chat.placeholderMobile"):d("chat.placeholder")),W=Vue.computed(()=>x.value||!w.value||w.value.trim()===""),Q=Vue.computed(()=>{let o=["p-4"];return m.value&&(o=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),o});return Vue.onMounted(()=>{T()}),Vue.onUnmounted(()=>{x.value&&a.abort()}),(o,u)=>(Vue.openBlock(),Vue.createElementBlock("div",st,[Vue.unref(m)?(Vue.openBlock(),Vue.createBlock(rt,{key:0,"using-context":Vue.unref(_),onExport:M,onToggleUsingContext:Vue.unref(R)},null,8,["using-context","onToggleUsingContext"])):Vue.createCommentVNode("",!0),Vue.createElementVNode("main",ut,[Vue.createElementVNode("div",{id:"scrollRef",ref_key:"scrollRef",ref:S,class:"h-full overflow-hidden overflow-y-auto"},[Vue.createElementVNode("div",{id:"image-wrapper",class:Vue.normalizeClass(["w-full max-w-screen-xl m-auto dark:bg-[#101014]",[Vue.unref(m)?"p-2":"p-4"]])},[Vue.unref(b).length?(Vue.openBlock(),Vue.createElementBlock("div",dt,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(b),(c,V)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(Qe),{key:V,"date-time":c.dateTime,text:c.text,inversion:c.inversion,error:c.error,loading:c.loading,onRegenerate:t=>P(V),onDelete:t=>j(V)},null,8,["date-time","text","inversion","error","loading","onRegenerate","onDelete"]))),128)),Vue.createElementVNode("div",ft,[x.value?(Vue.openBlock(),Vue.createBlock(Vue.unref(ne),{key:0,type:"warning",onClick:H},{icon:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(C),{icon:"ri:stop-circle-line"})]),default:Vue.withCtx(()=>[Vue.createTextVNode(" 暂停 ")]),_:1})):Vue.createCommentVNode("",!0)])])):(Vue.openBlock(),Vue.createElementBlock("div",it,[Vue.createVNode(Vue.unref(C),{icon:"ri:bubble-chart-fill",class:"mr-2 text-3xl"}),ct]))],2)],512)]),Vue.createElementVNode("footer",{class:Vue.normalizeClass(Vue.unref(Q))},[Vue.createElementVNode("div",mt,[Vue.createElementVNode("div",pt,[Vue.createVNode(Vue.unref(D),{onClick:$},{default:Vue.withCtx(()=>[Vue.createElementVNode("span",ht,[Vue.createVNode(Vue.unref(C),{icon:"ri:delete-bin-line"})])]),_:1}),Vue.unref(m)?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(Vue.unref(D),{key:0,onClick:M},{default:Vue.withCtx(()=>[Vue.createElementVNode("span",Vt,[Vue.createVNode(Vue.unref(C),{icon:"ri:download-2-line"})])]),_:1})),Vue.unref(m)?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(Vue.unref(D),{key:1,onClick:Vue.unref(R)},{default:Vue.withCtx(()=>[Vue.createElementVNode("span",{class:Vue.normalizeClass(["text-xl",{"text-[#4b9e5f]":Vue.unref(_),"text-[#a8071a]":!Vue.unref(_)}])},[Vue.createVNode(Vue.unref(C),{icon:"ri:chat-history-line"})],2)]),_:1},8,["onClick"])),Vue.createVNode(Vue.unref(Le),{value:w.value,"onUpdate:value":u[1]||(u[1]=c=>w.value=c),options:Vue.unref(K),"render-label":Z},{default:Vue.withCtx(({handleInput:c,handleBlur:V,handleFocus:t})=>[Vue.createVNode(Vue.unref(le),{value:w.value,"onUpdate:value":u[0]||(u[0]=l=>w.value=l),type:"textarea",placeholder:Vue.unref(J),autosize:{minRows:1,maxRows:Vue.unref(m)?4:8},onInput:c,onFocus:t,onBlur:V,onKeypress:q},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur"])]),_:1},8,["value","options"]),Vue.createVNode(Vue.unref(ne),{type:"primary",disabled:Vue.unref(W),onClick:I},{icon:Vue.withCtx(()=>[Vue.createElementVNode("span",vt,[Vue.createVNode(Vue.unref(C),{icon:"ri:send-plane-fill"})])]),_:1},8,["disabled"])])])],2)]))}});export{yt as default};
