import{c as Oe,a as ve,f as Ie,d as N,u as Re,b as Ae,r as M,t as Le,e as Me,g as Ce,h as T,i as Ue,j as De,k as fe,l as L,V as $e,m as Fe,n as Ve,N as we,o as Pe,T as ze,w as Ee,p as je,q as Ne,s as Ke,v as qe,x as He,y as Ze,z as j,A as Je,B as m,C as B,D as n,E as We,F as V,G as ge,H as xe,I as ke,J as d,K as pe,L as h,M as he,O as D,_ as R,P as w,Q as J,R as U,S as Qe,U as te,W as me,X as _e,Y as Ye,Z as Te,$ as Ge,a0 as W,a1 as Xe,a2 as et,a3 as tt,a4 as nt,a5 as ot,a6 as at,a7 as st,a8 as ye,a9 as lt,aa as be}from"./index-5ff6cd00.js";import rt from"https://cdn.jsdelivr.net/npm/markdown-it/+esm";import it from"https://cdn.jsdelivr.net/npm/@traptitech/markdown-it-katex/+esm";function ct(e){return e.map(Se)}function Se(e){var l,o;return typeof e=="string"?{label:e,value:e}:e.type==="group"?{type:"group",label:(l=e.label)!==null&&l!==void 0?l:e.name,value:(o=e.value)!==null&&o!==void 0?o:e.name,key:e.key||e.name,children:e.children.map(r=>Se(r))}:e}const ut=Oe([ve("auto-complete",`
 z-index: auto;
 position: relative;
 display: inline-flex;
 width: 100%;
 `),ve("auto-complete-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[Ie({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),dt=Object.assign(Object.assign({},Ce.props),{to:fe.propTo,menuProps:Object,bordered:{type:Boolean,default:void 0},clearable:{type:Boolean,default:void 0},defaultValue:{type:String,default:null},loading:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},placeholder:String,placement:{type:String,default:"bottom-start"},value:String,blurAfterSelect:Boolean,clearAfterSelect:Boolean,getShow:Function,inputProps:Object,renderOption:Function,renderLabel:Function,size:String,options:{type:Array,default:()=>[]},zIndex:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onSelect:[Function,Array],onBlur:[Function,Array],onFocus:[Function,Array],onInput:[Function,Array]}),ft=N({name:"AutoComplete",props:dt,setup(e){const{mergedBorderedRef:l,namespaceRef:o,mergedClsPrefixRef:c,inlineThemeDisabled:r}=Re(e),i=Ae(e),{mergedSizeRef:y,mergedDisabledRef:g,mergedStatusRef:_}=i,x=M(null),f=M(null),$=M(e.defaultValue),F=Le(e,"value"),K=Me(F,$),O=M(!1),P=M(!1),q=Ce("AutoComplete","-auto-complete",ut,Ke,e,c),b=T(()=>ct(e.options)),I=T(()=>{const{getShow:t}=e;return t?t(K.value||""):!!K.value}),Q=T(()=>I.value&&O.value&&!!b.value.length),A=T(()=>qe(b.value,Ze("value","children")));function C(t){const{"onUpdate:value":a,onUpdateValue:p,onInput:k}=e,{nTriggerFormInput:z,nTriggerFormChange:S}=i;p&&j(p,t),a&&j(a,t),k&&j(k,t),$.value=t,z(),S()}function ne(t){const{onSelect:a}=e,{nTriggerFormInput:p,nTriggerFormChange:k}=i;a&&j(a,t),p(),k()}function Y(t){const{onBlur:a}=e,{nTriggerFormBlur:p}=i;a&&j(a,t),p()}function H(t){const{onFocus:a}=e,{nTriggerFormFocus:p}=i;a&&j(a,t),p()}function oe(){P.value=!0}function ae(){window.setTimeout(()=>{P.value=!1},0)}function G(t){var a,p,k;switch(t.key){case"Enter":if(!P.value){const z=(a=f.value)===null||a===void 0?void 0:a.getPendingTmNode();z&&(X(z.rawNode),t.preventDefault())}break;case"ArrowDown":(p=f.value)===null||p===void 0||p.next();break;case"ArrowUp":(k=f.value)===null||k===void 0||k.prev();break}}function X(t){(t==null?void 0:t.value)!==void 0&&(ne(t.value),e.clearAfterSelect?C(null):t.label!==void 0&&C(t.label),O.value=!1,e.blurAfterSelect&&de())}function se(){C(null)}function le(t){O.value=!0,H(t)}function re(t){O.value=!1,Y(t)}function ie(t){O.value=!0,C(t)}function ce(t){X(t.rawNode)}function ue(t){var a;!((a=x.value)===null||a===void 0)&&a.contains(He(t))||(O.value=!1)}function de(){var t,a;!((t=x.value)===null||t===void 0)&&t.contains(document.activeElement)&&((a=document.activeElement)===null||a===void 0||a.blur())}const ee=T(()=>{const{common:{cubicBezierEaseInOut:t},self:{menuBoxShadow:a}}=q.value;return{"--n-menu-box-shadow":a,"--n-bezier":t}}),s=r?Ue("auto-complete",void 0,ee,e):void 0,u=M(null),v={focus:()=>{var t;(t=u.value)===null||t===void 0||t.focus()},blur:()=>{var t;(t=u.value)===null||t===void 0||t.blur()}};return{focus:v.focus,blur:v.blur,inputInstRef:u,uncontrolledValue:$,mergedValue:K,isMounted:De(),adjustedTo:fe(e),menuInstRef:f,triggerElRef:x,treeMate:A,mergedSize:y,mergedDisabled:g,active:Q,mergedStatus:_,handleClear:se,handleFocus:le,handleBlur:re,handleInput:ie,handleToggle:ce,handleClickOutsideMenu:ue,handleCompositionStart:oe,handleCompositionEnd:ae,handleKeyDown:G,mergedTheme:q,cssVars:r?void 0:ee,themeClass:s==null?void 0:s.themeClass,onRender:s==null?void 0:s.onRender,mergedBordered:l,namespace:o,mergedClsPrefix:c}},render(){const{mergedClsPrefix:e}=this;return L("div",{class:`${e}-auto-complete`,ref:"triggerElRef",onKeydown:this.handleKeyDown,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd},L($e,null,{default:()=>[L(Fe,null,{default:()=>{if(this.$slots.default)return Ve(this.$slots,"default",{handleInput:this.handleInput,handleFocus:this.handleFocus,handleBlur:this.handleBlur,value:this.mergedValue});const{mergedTheme:o}=this;return L(we,{ref:"inputInstRef",status:this.mergedStatus,theme:o.peers.Input,themeOverrides:o.peerOverrides.Input,bordered:this.mergedBordered,value:this.mergedValue,placeholder:this.placeholder,size:this.mergedSize,disabled:this.mergedDisabled,clearable:this.clearable,loading:this.loading,inputProps:this.inputProps,onClear:this.handleClear,onFocus:this.handleFocus,onUpdateValue:this.handleInput,onBlur:this.handleBlur},{suffix:()=>{var c,r;return(r=(c=this.$slots).suffix)===null||r===void 0?void 0:r.call(c)},prefix:()=>{var c,r;return(r=(c=this.$slots).prefix)===null||r===void 0?void 0:r.call(c)}})}}),L(Pe,{show:this.active,to:this.adjustedTo,containerClass:this.namespace,zIndex:this.zIndex,teleportDisabled:this.adjustedTo===fe.tdkey,placement:this.placement,width:"target"},{default:()=>L(ze,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{var l;if((l=this.onRender)===null||l===void 0||l.call(this),!this.active)return null;const{menuProps:o}=this;return Ee(L(Ne,Object.assign({},o,{clsPrefix:e,ref:"menuInstRef",theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,"auto-pending":!0,class:[`${e}-auto-complete-menu`,this.themeClass,o==null?void 0:o.class],style:[o==null?void 0:o.style,this.cssVars],treeMate:this.treeMate,multiple:!1,renderLabel:this.renderLabel,renderOption:this.renderOption,size:"medium",onToggle:this.handleToggle})),[[je,this.handleClickOutsideMenu,void 0,{capture:!0}]])}})})]}))}}),pt={key:1,class:"text-[28px] dark:text-white"},ht=d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",width:"1em",height:"1em"},[d("path",{d:"M29.71,13.09A8.09,8.09,0,0,0,20.34,2.68a8.08,8.08,0,0,0-13.7,2.9A8.08,8.08,0,0,0,2.3,18.9,8,8,0,0,0,3,25.45a8.08,8.08,0,0,0,8.69,3.87,8,8,0,0,0,6,2.68,8.09,8.09,0,0,0,7.7-5.61,8,8,0,0,0,5.33-3.86A8.09,8.09,0,0,0,29.71,13.09Zm-12,16.82a6,6,0,0,1-3.84-1.39l.19-.11,6.37-3.68a1,1,0,0,0,.53-.91v-9l2.69,1.56a.08.08,0,0,1,.05.07v7.44A6,6,0,0,1,17.68,29.91ZM4.8,24.41a6,6,0,0,1-.71-4l.19.11,6.37,3.68a1,1,0,0,0,1,0l7.79-4.49V22.8a.09.09,0,0,1,0,.08L13,26.6A6,6,0,0,1,4.8,24.41ZM3.12,10.53A6,6,0,0,1,6.28,7.9v7.57a1,1,0,0,0,.51.9l7.75,4.47L11.85,22.4a.14.14,0,0,1-.09,0L5.32,18.68a6,6,0,0,1-2.2-8.18Zm22.13,5.14-7.78-4.52L20.16,9.6a.08.08,0,0,1,.09,0l6.44,3.72a6,6,0,0,1-.9,10.81V16.56A1.06,1.06,0,0,0,25.25,15.67Zm2.68-4-.19-.12-6.36-3.7a1,1,0,0,0-1.05,0l-7.78,4.49V9.2a.09.09,0,0,1,0-.09L19,5.4a6,6,0,0,1,8.91,6.21ZM11.08,17.15,8.38,15.6a.14.14,0,0,1-.05-.08V8.1a6,6,0,0,1,9.84-4.61L18,3.6,11.61,7.28a1,1,0,0,0-.53.91ZM12.54,14,16,12l3.47,2v4L16,20l-3.47-2Z",fill:"currentColor"})],-1),mt=[ht],vt=N({__name:"Avatar",props:{image:{type:Boolean}},setup(e){const l=Je(),o=T(()=>l.userInfo.avatar);return(c,r)=>e.image?(m(),B(ke,{key:0},[n(We)(n(o))&&n(o).length>0?(m(),V(n(xe),{key:0,src:n(o),"fallback-src":n(ge)},null,8,["src","fallback-src"])):(m(),V(n(xe),{key:1,round:"",src:n(ge)},null,8,["src"]))],64)):(m(),B("span",pt,mt))}}),gt={key:0,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},xt=["innerHTML"],yt=["textContent"],bt=N({__name:"Text",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean}},setup(e,{expose:l}){const o=e,{isMobile:c}=pe(),r=M(),i=new rt({linkify:!0,highlight(x,f){if(!!(f&&hljs.getLanguage(f))){const F=f??"";return _(hljs.highlight(F,x,!0).value,F)}return _(hljs.highlightAuto(x).value,"")}});i.use(it,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const y=T(()=>["text-wrap","min-w-[20px]","rounded-md",c.value?"p-2":"px-3 py-2",o.inversion?"bg-[#d2f9d1]":"bg-[#f4f6f8]",o.inversion?"dark:bg-[#a1dc95]":"dark:bg-[#1e1e20]",{"text-red-500":o.error}]),g=T(()=>{const x=o.text??"";return o.inversion?x:i.render(x)});function _(x,f){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${f}</span><span class="code-block-header__copy">${h("chat.copyCode")}</span></div><code class="hljs code-block-body ${f}">${x}</code></pre>`}return l({textRef:r}),(x,f)=>(m(),B("div",{class:D(["text-black",n(y)])},[e.loading?(m(),B("span",gt)):(m(),B("div",{key:1,ref_key:"textRef",ref:r,class:"leading-relaxed break-words"},[e.inversion?(m(),B("div",{key:1,class:"whitespace-pre-wrap",textContent:he(n(g))},null,8,yt)):(m(),B("div",{key:0,class:"markdown-body",innerHTML:n(g)},null,8,xt))],512))],2))}});function Be(e){const l={origin:!0,...e};let o;l.origin?o=document.createElement("textarea"):o=document.createElement("input"),o.setAttribute("readonly","readonly"),o.value=l.text,document.body.appendChild(o),o.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(o)}const Ct=()=>({iconRender:l=>{const{color:o,fontSize:c,icon:r}=l,i={};return o&&(i.color=o),c&&(i.fontSize=`${c}px`),r||window.console.warn("iconRender: icon is required"),()=>L(R,{icon:r,style:i})}}),wt={class:"flex flex-col"},kt={class:"transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-200"},_t=N({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean}},emits:["regenerate","delete"],setup(e,{emit:l}){const o=e,{iconRender:c}=Ct(),{isMobile:r}=pe(),i=M(),y=[{label:h("chat.copy"),key:"copyText",icon:c({icon:"ri:file-copy-2-line"})},{label:h("common.delete"),key:"delete",icon:c({icon:"ri:delete-bin-line"})}];function g(x){switch(x){case"copyText":Be({text:o.text??""});return;case"delete":l("delete")}}function _(){l("regenerate")}return(x,f)=>(m(),B("div",{class:D(["flex w-full mb-6 overflow-hidden",[{"flex-row-reverse":e.inversion}]])},[d("div",{class:D(["flex items-center justify-center flex-shrink-0 h-8 overflow-hidden rounded-full basis-8",[e.inversion?"ml-2":"mr-2"]])},[w(vt,{image:e.inversion},null,8,["image"])],2),d("div",{class:D(["overflow-hidden text-sm",[e.inversion?"items-end":"items-start",n(r)?"":"max-w-4/5"]])},[d("p",{class:D(["text-xs text-[#b4bbc4]",[e.inversion?"text-right":"text-left"]])},he(e.dateTime),3),d("div",{class:D(["flex items-end gap-1 mt-2",[e.inversion?"flex-row-reverse":"flex-row"]])},[w(bt,{ref_key:"textRef",ref:i,inversion:e.inversion,error:e.error,text:e.text,loading:e.loading},null,8,["inversion","error","text","loading"]),d("div",wt,[e.inversion?J("",!0):(m(),B("button",{key:0,class:"mb-2 transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-300",onClick:_},[w(n(R),{icon:"ri:restart-line"})])),w(n(Qe),{placement:e.inversion?"left":"right",options:y,onSelect:g},{default:U(()=>[d("button",kt,[w(n(R),{icon:"ri:more-2-fill"})])]),_:1},8,["placement"])])],2)],2)],2))}});function Tt(){const e=M(null);return{scrollRef:e,scrollToBottom:async()=>{await te(),e.value&&(e.value.scrollTop=e.value.scrollHeight)},scrollToTop:async()=>{await te(),e.value&&(e.value.scrollTop=0)},scrollToBottomIfAtBottom:async()=>{await te(),e.value&&e.value.scrollHeight-e.value.scrollTop-e.value.clientHeight<=50&&(e.value.scrollTop=e.value.scrollHeight)}}}function St(){const e=me();return{addChat:(i,y)=>{e.addChatByUuid(i,y)},updateChat:(i,y,g)=>{e.updateChatByUuid(i,y,g)},updateChatSome:(i,y,g)=>{e.updateChatSomeByUuid(i,y,g)},getChatByUuidAndIndex:(i,y)=>e.getChatByUuidAndIndex(i,y)}}function Bt(){function e(){document.querySelectorAll(".code-block-wrapper").forEach(o=>{const c=o.querySelector(".code-block-header__copy"),r=o.querySelector(".code-block-body");c&&r&&c.addEventListener("click",()=>{var i;(i=navigator.clipboard)!=null&&i.writeText?navigator.clipboard.writeText(r.textContent??""):Be({text:r.textContent??"",origin:!0})})})}_e(()=>e()),Ye(()=>e())}function Ot(){const e=Te(),l=M(!0);function o(){l.value=!l.value,l.value?e.success(h("chat.turnOnContext")):e.warning(h("chat.turnOffContext"))}return{usingContext:l,toggleUsingContext:o}}const It={class:"sticky top-0 left-0 right-0 z-30 border-b dark:border-neutral-800 bg-white/80 dark:bg-black/20 backdrop-blur"},Rt={class:"relative flex items-center justify-between min-w-0 overflow-hidden h-14"},At={class:"flex items-center"},Lt={class:"flex items-center space-x-2"},Mt={class:"text-xl text-[#4f555e] dark:text-white"},Ut=N({__name:"index",props:{usingContext:{type:Boolean}},emits:["export","toggleUsingContext"],setup(e,{emit:l}){const o=Ge(),c=me(),r=T(()=>o.siderCollapsed),i=T(()=>c.getChatHistoryByCurrentActive);function y(){o.setSiderCollapsed(!r.value)}function g(){const f=document.querySelector("#scrollRef");f&&te(()=>f.scrollTop=0)}function _(){l("export")}function x(){l("toggleUsingContext")}return(f,$)=>{var F;return m(),B("header",It,[d("div",Rt,[d("div",At,[d("button",{class:"flex items-center justify-center w-11 h-11",onClick:y},[n(r)?(m(),V(n(R),{key:0,class:"text-2xl",icon:"ri:align-justify"})):(m(),V(n(R),{key:1,class:"text-2xl",icon:"ri:align-right"}))])]),d("h1",{class:"flex-1 px-4 pr-6 overflow-hidden cursor-pointer select-none text-ellipsis whitespace-nowrap",onDblclick:g},he(((F=n(i))==null?void 0:F.title)??""),33),d("div",Lt,[w(n(W),{onClick:x},{default:U(()=>[d("span",{class:D(["text-xl",{"text-[#4b9e5f]":e.usingContext,"text-[#a8071a]":!e.usingContext}])},[w(n(R),{icon:"ri:chat-history-line"})],2)]),_:1}),w(n(W),{onClick:_},{default:U(()=>[d("span",Mt,[w(n(R),{icon:"ri:download-2-line"})])]),_:1})])])])}}}),Dt={class:"flex flex-col w-full h-full"},$t={class:"flex-1 overflow-hidden"},Ft={key:0,class:"flex items-center justify-center mt-4 text-center text-neutral-300"},Vt=d("span",null,"欢迎使用chatgpt~",-1),Pt={key:1},zt={class:"sticky bottom-0 left-0 flex justify-center"},Et={class:"w-full max-w-screen-xl m-auto"},jt={class:"flex items-center justify-between space-x-2"},Nt={class:"text-xl text-[#4f555e] dark:text-white"},Kt={class:"text-xl text-[#4f555e] dark:text-white"},qt={class:"dark:text-black"},Wt=N({__name:"index",setup(e){let l=new AbortController;const o=!1,c=Xe(),r=et(),i=Te(),y=me(),g=tt();Bt();const{isMobile:_}=pe(),{addChat:x,updateChat:f,updateChatSome:$,getChatByUuidAndIndex:F}=St(),{scrollRef:K,scrollToBottom:O}=Tt(),{usingContext:P,toggleUsingContext:q}=Ot(),{uuid:b}=c.params,I=T(()=>y.getChatByUuid(+b)),Q=T(()=>I.value.filter(s=>!s.inversion&&!s.error)),A=M(""),C=M(!1),ne=nt(),{promptList:Y}=ot(ne);function H(){if(!g.chatKey){r.success({title:"卡密为空，请点击链接获取卡密",content:()=>L("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:"16px"}},[L("p",{style:{textAlign:"center",fontWeight:"bold"}},[L("p",["获取卡密: ",L("a",{href:"https://dwz.cn/EgY7bwVr",target:"_blank",style:{color:"blue",fontSzie:"18px",textDecoration:"underline"}},"https://dwz.cn/EgY7bwVr")])])]),positiveText:"OK"});return}oe()}async function oe(){var t;let s=A.value;if(C.value||!s||s.trim()==="")return;l=new AbortController,x(+b,{dateTime:new Date().toLocaleString(),text:s,inversion:!0,error:!1,conversationOptions:null,requestOptions:{prompt:s,options:null}}),O(),C.value=!0,A.value="";let u={};const v=(t=Q.value[Q.value.length-1])==null?void 0:t.conversationOptions;v&&P.value&&(u={...v}),x(+b,{dateTime:new Date().toLocaleString(),text:"",loading:!0,inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:s,options:{...u}}}),O();try{await(async()=>{await ye({prompt:s,options:u,type:g.type,signal:l.signal,chatKey:g.chatKey,onDownloadProgress:({event:p})=>{const k=p.target,{responseText:z}=k,S=z.split("&KFw6loC9Qvy&");try{if(S[0]==="image")f(+b,I.value.length-1,{dateTime:new Date().toLocaleString(),text:`![Alt text](${S[1]||""})`,inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:"1",parentMessageId:"1"},requestOptions:{prompt:s,options:{...u}}});else{const E=JSON.parse(S[0]),Z=S[2]&&JSON.parse(S[2]);f(+b,I.value.length-1,{dateTime:new Date().toLocaleString(),text:S[1]||"",inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:E.conversationId,parentMessageId:E.id},requestOptions:{prompt:s,options:{...u}}}),o&&Z&&Z.detail.choices[0].finish_reason}O()}catch{}}})})()}catch(a){const p=(a==null?void 0:a.message)??h("common.wrong");if(a.message==="canceled"){$(+b,I.value.length-1,{loading:!1}),O();return}const k=F(+b,I.value.length-1);if(k!=null&&k.text&&k.text!==""){$(+b,I.value.length-1,{text:`${k.text}
${p}`,error:!1,loading:!1});return}f(+b,I.value.length-1,{dateTime:new Date().toLocaleString(),text:p,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:s,options:{...u}}}),O()}finally{C.value=!1,g.recordState(g.chatKey,!0)}}async function ae(s){if(C.value)return;l=new AbortController;const{requestOptions:u}=I.value[s];let v=(u==null?void 0:u.prompt)??"",t={};u.options&&(t={...u.options}),C.value=!0,f(+b,s,{dateTime:new Date().toLocaleString(),text:"",inversion:!1,error:!1,loading:!0,conversationOptions:null,requestOptions:{prompt:v,...t}});try{await(async()=>{await ye({prompt:v,options:t,type:g.type,signal:l.signal,chatKey:g.chatKey,onDownloadProgress:async({event:p})=>{const k=p.target,{responseText:z}=k,S=z.split("&KFw6loC9Qvy&");try{if(S[0]==="image")f(+b,I.value.length-1,{dateTime:new Date().toLocaleString(),text:`![Alt text](${S[1]||""})`,inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:"1",parentMessageId:"1"},requestOptions:{prompt:v,options:{...t}}});else{const E=JSON.parse(S[0]),Z=S[2]&&JSON.parse(S[2]);f(+b,s,{dateTime:new Date().toLocaleString(),text:S[1]||"",inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:E.conversationId,parentMessageId:E.id},requestOptions:{prompt:v,...t}}),o&&Z&&Z.detail.choices[0].finish_reason}}catch{}}})})()}catch(a){if(a.message==="canceled"){$(+b,s,{loading:!1});return}const p=(a==null?void 0:a.message)??h("common.wrong");f(+b,s,{dateTime:new Date().toLocaleString(),text:p,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:v,...t}})}finally{C.value=!1}}function G(){if(C.value)return;const s=r.warning({title:h("chat.exportImage"),content:h("chat.exportImageConfirm"),positiveText:h("common.yes"),negativeText:h("common.no"),onPositiveClick:async()=>{try{s.loading=!0;const u=document.getElementById("image-wrapper"),t=(await html2canvas(u,{useCORS:!0})).toDataURL("image/png"),a=document.createElement("a");a.style.display="none",a.href=t,a.setAttribute("download","chat-shot.png"),typeof a.download>"u"&&a.setAttribute("target","_blank"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t),s.loading=!1,i.success(h("chat.exportSuccess")),Promise.resolve()}catch{i.error(h("chat.exportFailed"))}finally{s.loading=!1}}})}function X(s){C.value||r.warning({title:h("chat.deleteMessage"),content:h("chat.deleteMessageConfirm"),positiveText:h("common.yes"),negativeText:h("common.no"),onPositiveClick:()=>{y.deleteChatByUuid(+b,s)}})}function se(){C.value||r.warning({title:h("chat.clearChat"),content:h("chat.clearChatConfirm"),positiveText:h("common.yes"),negativeText:h("common.no"),onPositiveClick:()=>{y.clearChatByUuid(+b)}})}function le(s){_.value?s.key==="Enter"&&s.ctrlKey&&(s.preventDefault(),H()):s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),H())}function re(){C.value&&(l.abort(),C.value=!1)}const ie=T(()=>A.value.startsWith("/")?Y.value.filter(s=>s.key.toLowerCase().includes(A.value.substring(1).toLowerCase())).map(s=>({label:s.value,value:s.value})):[]),ce=s=>{for(const u of Y.value)if(u.value===s.label)return[u.key];return[]},ue=T(()=>_.value?h("chat.placeholderMobile"):h("chat.placeholder")),de=T(()=>C.value||!A.value||A.value.trim()===""),ee=T(()=>{let s=["p-4"];return _.value&&(s=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),s});return _e(()=>{O()}),at(()=>{C.value&&l.abort()}),(s,u)=>(m(),B("div",Dt,[n(_)?(m(),V(Ut,{key:0,"using-context":n(P),onExport:G,onToggleUsingContext:n(q)},null,8,["using-context","onToggleUsingContext"])):J("",!0),d("main",$t,[d("div",{id:"scrollRef",ref_key:"scrollRef",ref:K,class:"h-full overflow-hidden overflow-y-auto"},[d("div",{id:"image-wrapper",class:D(["w-full max-w-screen-xl m-auto dark:bg-[#101014]",[n(_)?"p-2":"p-4"]])},[n(I).length?(m(),B("div",Pt,[(m(!0),B(ke,null,st(n(I),(v,t)=>(m(),V(n(_t),{key:t,"date-time":v.dateTime,text:v.text,inversion:v.inversion,error:v.error,loading:v.loading,onRegenerate:a=>ae(t),onDelete:a=>X(t)},null,8,["date-time","text","inversion","error","loading","onRegenerate","onDelete"]))),128)),d("div",zt,[C.value?(m(),V(n(be),{key:0,type:"warning",onClick:re},{icon:U(()=>[w(n(R),{icon:"ri:stop-circle-line"})]),default:U(()=>[lt(" 暂停 ")]),_:1})):J("",!0)])])):(m(),B("div",Ft,[w(n(R),{icon:"ri:bubble-chart-fill",class:"mr-2 text-3xl"}),Vt]))],2)],512)]),d("footer",{class:D(n(ee))},[d("div",Et,[d("div",jt,[w(n(W),{onClick:se},{default:U(()=>[d("span",Nt,[w(n(R),{icon:"ri:delete-bin-line"})])]),_:1}),n(_)?J("",!0):(m(),V(n(W),{key:0,onClick:G},{default:U(()=>[d("span",Kt,[w(n(R),{icon:"ri:download-2-line"})])]),_:1})),n(_)?J("",!0):(m(),V(n(W),{key:1,onClick:n(q)},{default:U(()=>[d("span",{class:D(["text-xl",{"text-[#4b9e5f]":n(P),"text-[#a8071a]":!n(P)}])},[w(n(R),{icon:"ri:chat-history-line"})],2)]),_:1},8,["onClick"])),w(n(ft),{value:A.value,"onUpdate:value":u[1]||(u[1]=v=>A.value=v),options:n(ie),"render-label":ce},{default:U(({handleInput:v,handleBlur:t,handleFocus:a})=>[w(n(we),{value:A.value,"onUpdate:value":u[0]||(u[0]=p=>A.value=p),"show-count":"",type:"textarea",placeholder:n(ue),autosize:{minRows:1,maxRows:n(_)?4:8},onInput:v,onFocus:a,onBlur:t,onKeypress:le},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur"])]),_:1},8,["value","options"]),w(n(be),{type:"primary",disabled:n(de),onClick:H},{icon:U(()=>[d("span",qt,[w(n(R),{icon:"ri:send-plane-fill"})])]),_:1},8,["disabled"])])])],2)]))}});export{Wt as default};
